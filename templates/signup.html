<!DOCTYPE html>
<html lang="en" dir="{{ 'rtl' if lang == 'ar' else 'ltr' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sign up for your Cyber Threat App account.">
    <meta name="author" content="Your Team Name">
    <title>{{ 'إنشاء حساب - تطبيق Cyber Threat' if lang == 'ar' else 'Sign Up - Cyber Threat App' }}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- Google Fonts - Inter (for LTR) and Cairo (for RTL) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        /* CSS Variables for easier theme management */
        :root {
            --dark-bg: #0d1117; /* Even darker background */
            --card-bg: #161b22; /* Darker card background */
            --input-bg: #010409; /* Very dark input background */
            --input-border: #30363d; /* Subtle border for inputs */
            --text-color: #c9d1d9; /* Lighter text for contrast */
            --accent-color: #58a6ff; /* GitHub-like blue */
            --success-color: #2ea043; /* Darker success green */
            --danger-color: #f85149; /* Darker danger red */
            --light-text: #8b949e; /* Muted text */
            --button-hover-bg: #30363d;
            --button-hover-text: #c9d1d9;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            font-family: 'Inter', sans-serif; /* Default to Inter */
            {% if lang == 'ar' %}
            font-family: 'Cairo', sans-serif; /* Use Cairo for Arabic */
            {% endif %}
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent scroll if content slightly overflows */
            position: relative; /* For background animation */
        }

        /* Subtle animated background */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(88, 166, 255, 0.1) 0%, rgba(13, 17, 23, 0) 50%, rgba(88, 166, 255, 0.1) 100%);
            background-size: 200% 200%;
            animation: gradient-shift 15s ease infinite alternate;
            z-index: -1;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .signup-box {
            background-color: var(--card-bg);
            padding: 40px; /* Increased padding */
            border-radius: 20px; /* More rounded corners */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6); /* Deeper shadow */
            max-width: 450px; /* Slightly wider box */
            width: 90%; /* Responsive width */
            text-align: center; /* Center content */
            border: 1px solid rgba(255, 255, 255, 0.15); /* Subtle border */
            animation: fadeIn 0.8s ease-out forwards; /* Fade-in animation on load */
            opacity: 0; /* Start invisible for animation */
            transform: translateY(20px); /* Start slightly below for animation */
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .signup-box h3 {
            color: var(--accent-color);
            margin-bottom: 30px; /* More space below title */
            font-weight: 700; /* Bolder heading */
            font-size: 2.5rem; /* Larger title */
            text-shadow: 0 0 10px rgba(88, 166, 255, 0.3); /* Subtle glow */
        }

        .form-label {
            color: var(--light-text);
            font-weight: 600; /* Bolder label font weight */
            margin-bottom: 8px; /* Space between label and input */
            display: block; /* Ensure label is on its own line */
            text-align: start; /* Align labels to start */
            font-size: 0.95rem;
        }

        .form-control {
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-color);
            padding: 12px 15px; /* More padding for inputs */
            border-radius: 10px; /* Rounded input fields */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-control:focus {
            background-color: var(--input-bg);
            border-color: var(--accent-color);
            color: var(--text-color);
            box-shadow: 0 0 0 0.25rem rgba(88, 166, 255, 0.25); /* Accent color glow */
            outline: none; /* Remove default outline */
        }

        .form-control::placeholder {
            color: #6a737d; /* Placeholder color */
        }

        /* Input group for password visibility toggle */
        .input-group-password {
            position: relative;
        }
        .input-group-password .form-control {
            padding-right: 45px; /* Space for icon */
        }
        .input-group-password .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--light-text);
            transition: color 0.2s ease;
            z-index: 10; /* Ensure icon is clickable */
        }
        .input-group-password .toggle-password:hover {
            color: var(--accent-color);
        }

        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
            padding: 12px 0; /* Vertical padding, full width */
            border-radius: 10px;
            font-weight: 600; /* Bolder button text */
            font-size: 1.1rem;
            margin-top: 20px; /* Space above button */
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        .btn-success:hover {
            background-color: #268c37; /* Slightly darker green on hover */
            border-color: #268c37;
            transform: translateY(-2px); /* Slight lift effect */
            box-shadow: 0 5px 15px rgba(46, 160, 67, 0.4);
        }

        .alert {
            margin-top: 25px; /* More space above alert */
            border-radius: 10px;
            font-weight: 500;
            text-align: start; /* Align alert text to start */
            padding: 15px 20px;
            opacity: 1;
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .alert.fade-out {
            opacity: 0;
            transform: translateY(-10px);
        }
        .alert-danger {
            background-color: var(--danger-color);
            color: var(--text-color);
            border-color: rgba(248, 81, 73, 0.5);
        }

        .text-muted a {
            color: var(--accent-color) !important; /* Ensure link color is accent */
            font-weight: 600;
            transition: color 0.2s ease;
        }
        .text-muted a:hover {
            color: #79b8ff !important; /* Lighter accent on hover */
            text-decoration: underline !important;
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 5px;
            text-align: start;
            display: none; /* Hidden by default */
        }
        .form-control.is-invalid + .error-message {
            display: block;
        }
        .form-control.is-invalid {
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 0.25rem rgba(248, 81, 73, 0.25) !important;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .signup-box {
                padding: 30px 25px;
            }
            .signup-box h3 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="signup-box">
        <h3 class="text-center mb-4">{{ 'إنشاء حساب' if lang == 'ar' else 'Sign Up' }}</h3>
        <form id="signupForm" method="POST" novalidate>
            <div class="mb-3">
                <label for="usernameInput" class="form-label">{{ 'اسم المستخدم' if lang == 'ar' else 'Username' }}</label>
                <input type="text" id="usernameInput" name="username" class="form-control" required minlength="3"
                       aria-label="{{ 'اسم المستخدم' if lang == 'ar' else 'Username' }}"
                       placeholder="{{ 'أدخل اسم المستخدم الخاص بك' if lang == 'ar' else 'Enter your username' }}">
                <div id="usernameError" class="error-message"></div>
            </div>
            <div class="mb-3 input-group-password">
                <label for="passwordInput" class="form-label">{{ 'كلمة المرور' if lang == 'ar' else 'Password' }}</label>
                <input type="password" id="passwordInput" name="password" class="form-control" required minlength="8"
                       aria-label="{{ 'كلمة المرور' if lang == 'ar' else 'Password' }}"
                       placeholder="{{ 'أدخل كلمة المرور (8 أحرف على الأقل)' if lang == 'ar' else 'Enter your password (min 8 characters)' }}">
                <i class="bi bi-eye-slash toggle-password" id="togglePassword" role="button" aria-label="{{ 'إظهار كلمة المرور' if lang == 'ar' else 'Show password' }}"></i>
                <div id="passwordError" class="error-message"></div>
            </div>
            <div class="mb-3 input-group-password">
                <label for="confirmPasswordInput" class="form-label">{{ 'تأكيد كلمة المرور' if lang == 'ar' else 'Confirm Password' }}</label>
                <input type="password" id="confirmPasswordInput" name="confirm_password" class="form-control" required
                       aria-label="{{ 'تأكيد كلمة المرور' if lang == 'ar' else 'Confirm Password' }}"
                       placeholder="{{ 'أعد إدخال كلمة المرور' if lang == 'ar' else 'Re-enter your password' }}">
                <i class="bi bi-eye-slash toggle-password" id="toggleConfirmPassword" role="button" aria-label="{{ 'إظهار كلمة المرور' if lang == 'ar' else 'Show confirm password' }}"></i>
                <div id="confirmPasswordError" class="error-message"></div>
            </div>
            <button type="submit" class="btn btn-success w-100" aria-label="{{ 'إنشاء حساب جديد' if lang == 'ar' else 'Create New Account' }}">
                {{ 'إنشاء حساب' if lang == 'ar' else 'Sign Up' }}
            </button>
        </form>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert alert-danger mt-3" role="alert" aria-live="assertive" id="flashMessage">
                    {{ messages[0] }}
                </div>
            {% endif %}
        {% endwith %}

        <div class="mt-4 text-center">
            <p class="text-muted small">
                {{ 'هل لديك حساب بالفعل؟' if lang == 'ar' else 'Already have an account?' }} 
                <a href="{{ url_for('login', lang=lang) }}" class="text-decoration-none">
                    {{ 'تسجيل الدخول' if lang == 'ar' else 'Log In' }}
                </a>
            </p>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const signupForm = document.getElementById('signupForm');
            const usernameInput = document.getElementById('usernameInput');
            const passwordInput = document.getElementById('passwordInput');
            const confirmPasswordInput = document.getElementById('confirmPasswordInput');
            const usernameError = document.getElementById('usernameError');
            const passwordError = document.getElementById('passwordError');
            const confirmPasswordError = document.getElementById('confirmPasswordError');
            const togglePassword = document.getElementById('togglePassword');
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const flashMessage = document.getElementById('flashMessage');

            // Function to display client-side validation errors
            const displayError = (element, message) => {
                if (element) {
                    element.textContent = message;
                    element.style.display = message ? 'block' : 'none';
                    const input = element.previousElementSibling; // Assuming error message is right after input
                    if (input && message) {
                        input.classList.add('is-invalid');
                    } else if (input) {
                        input.classList.remove('is-invalid');
                    }
                }
            };

            // Client-side form validation
            const validateForm = (event) => {
                let isValid = true;

                // Reset previous errors
                displayError(usernameError, '');
                displayError(passwordError, '');
                displayError(confirmPasswordError, '');
                usernameInput.classList.remove('is-invalid');
                passwordInput.classList.remove('is-invalid');
                confirmPasswordInput.classList.remove('is-invalid');

                // Validate Username
                if (usernameInput.value.trim().length < 3) {
                    displayError(usernameError, "{{ 'اسم المستخدم يجب أن يتكون من 3 أحرف على الأقل.' if lang == 'ar' else 'Username must be at least 3 characters long.' }}");
                    isValid = false;
                }

                // Validate Password
                if (passwordInput.value.length < 8) {
                    displayError(passwordError, "{{ 'كلمة المرور يجب أن تتكون من 8 أحرف على الأقل.' if lang == 'ar' else 'Password must be at least 8 characters long.' }}");
                    isValid = false;
                }

                // Validate Confirm Password
                if (confirmPasswordInput.value !== passwordInput.value) {
                    displayError(confirmPasswordError, "{{ 'كلمة المرور وتأكيد كلمة المرور غير متطابقين.' if lang == 'ar' else 'Password and confirm password do not match.' }}");
                    isValid = false;
                }

                if (!isValid) {
                    event.preventDefault(); // Prevent form submission if validation fails
                }
                return isValid;
            };

            // Attach validation to form submission
            if (signupForm) {
                signupForm.addEventListener('submit', validateForm);
            }

            // Real-time validation for password fields (optional, but good UX)
            passwordInput.addEventListener('input', () => {
                if (passwordInput.value.length < 8) {
                    displayError(passwordError, "{{ 'كلمة المرور يجب أن تتكون من 8 أحرف على الأقل.' if lang == 'ar' else 'Password must be at least 8 characters long.' }}");
                } else {
                    displayError(passwordError, '');
                }
                // Also check confirm password if password changes
                if (confirmPasswordInput.value && confirmPasswordInput.value !== passwordInput.value) {
                    displayError(confirmPasswordError, "{{ 'كلمة المرور وتأكيد كلمة المرور غير متطابقين.' if lang == 'ar' else 'Password and confirm password do not match.' }}");
                } else {
                    displayError(confirmPasswordError, '');
                }
            });

            confirmPasswordInput.addEventListener('input', () => {
                if (confirmPasswordInput.value !== passwordInput.value) {
                    displayError(confirmPasswordError, "{{ 'كلمة المرور وتأكيد كلمة المرور غير متطابقين.' if lang == 'ar' else 'Password and confirm password do not match.' }}");
                } else {
                    displayError(confirmPasswordError, '');
                }
            });

            // Toggle password visibility function
            const toggleVisibility = (inputElement, iconElement) => {
                const type = inputElement.getAttribute('type') === 'password' ? 'text' : 'password';
                inputElement.setAttribute('type', type);
                iconElement.classList.toggle('bi-eye');
                iconElement.classList.toggle('bi-eye-slash');
                iconElement.setAttribute('aria-label', type === 'password' ? "{{ 'إظهار كلمة المرور' if lang == 'ar' else 'Show password' }}" : "{{ 'إخفاء كلمة المرور' if lang == 'ar' else 'Hide password' }}");
            };

            // Attach toggle events
            if (togglePassword) {
                togglePassword.addEventListener('click', () => toggleVisibility(passwordInput, togglePassword));
            }
            if (toggleConfirmPassword) {
                toggleConfirmPassword.addEventListener('click', () => toggleVisibility(confirmPasswordInput, toggleConfirmPassword));
            }

            if (flashMessage) {
                setTimeout(() => {
                    flashMessage.classList.add('fade-out');
                    flashMessage.addEventListener('transitionend', () => flashMessage.remove());
                }, 5000);
            }
        });
    </script>
</body>
</html>